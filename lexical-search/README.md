# 형태 기반 검색

**ElasticSearch** 기반 형태 기반 검색은 **문장 구조·형태 정보가 유사한 오류 문장**을 빠르게 찾기 위한 기능입니다.
ChromaDB 기반 의미 검색에서 충분한 코사인 유사도를 가진 문장을 찾지 못한 경우, 이를 보완하기 위해 **형태 기반 검색을 추가적으로 수행**합니다.

<br>

## 형태 검색을 위한 데이터 정규화 규칙

검색 정확도를 높이기 위해, 형태소 분석 결과를 다음 기준에 따라 정규화합니다.  
이는 **어휘적 의미를 최대한 제거하고**, 문장의 구조적 특징을 드러내는 **형태적 기능 중심의 정보만 남기는 과정**입니다.

<br>

| 구분                          | 태그 목록                                                                                                                                                                |
| --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **태깅 정보로 표기할 태그**            | DETERMINER (관형사), ADVERB (부사), INTERJECTION (감탄사), AFFIX (접사), RADIX (어근), NUMERAL (수사), PUNCTUATION (구두점), SYMBOL (기호), UNKNOWN (불능 범주) |
| **자연어로 보존 할 태그**            | PARTICLE (조사), ENDING (어미), DEPENDENT_NOUN (의존 명사), AUXILIARY (보조 용언) |
| **끝 어절 받침 유무 정보 필요한 태그**    | NOUN (명사), DEPENDENT_NOUN (의존 명사), VERB (동사), AUXILIARY (보조 용언), ADJECTIVE (형용사)                                                                                     |
| **끝 어절 모음 양성/음성 정보 필요한 태그** | VERB (동사), AUXILIARY (보조 용언), ADJECTIVE (형용사)                                                                                                                        |

<br>

이 정규화된 태그 시퀀스는 `normalized_tags` 필드에 저장되며,  
Elasticsearch의 **custom analyzer + n-gram analyzer**를 통해 유사한 형태 패턴을 효과적으로 검색할 수 있습니다.

- **1차 검색**: `token_analyzer`를 사용해 정규화된 태그 시퀀스를 공백 단위로 매칭하여 구조적으로 가장 유사한 문장을 찾습니다.  

- **2차 검색**: `ngram_analyzer`를 사용해 태그 내부 2–3그램 단위의 부분 패턴을 비교하여 부족한 결과를 보완합니다.